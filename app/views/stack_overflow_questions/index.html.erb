<script type="text/javascript" charset="utf-8">
$(document).ready(function () {
  var languages = {
    <% @languages.each do |language| -%>
      "<%= language.name %>": {
        name: "<%= language.name %>",
        id: "<%= language.id %>"
      },
    <% end -%>
  };
  // var datasets = {
  //     "usa": {
  //         label: "USA",
  //         data: [[1988, 483994], [1989, 479060], [1990, 457648], [1991, 401949], [1992, 424705], [1993, 402375], [1994, 377867], [1995, 357382], [1996, 337946], [1997, 336185], [1998, 328611], [1999, 329421], [2000, 342172], [2001, 344932], [2002, 387303], [2003, 440813], [2004, 480451], [2005, 504638], [2006, 528692]]
  //     }
  // };

  // hard-code color indices to prevent them from shifting as
  // countries are turned on/off
  // var i = 0;
  // $.each(datasets, function(key, val) {
  //     val.color = i;
  //     ++i;
  // });

  // insert checkboxes 
  var choiceContainer = $("#choices");
  $.each(languages, function(key, val) {
      choiceContainer.append('<input type="checkbox" name="' + val.id +
                             '" id="id' + val.id + '">' +
                             '<label for="id' + val.id + '">'
                              + val.name + '</label>');
  });
  choiceContainer.find("input").click(plotAccordingToChoices);

  function plotAccordingToChoices() {
    
    // choiceContainer.find("input:checked").each(function () {
    //   var languageId = $(this).attr("name");
    // });
    
    var myData;
    $.getJSON('languages/1/stack_overflow_questions', function(data) {
      myData = data.data;
      console.log(myData);

      $.plot($("#placeholder"), myData, {
        yaxis: { min: 0 },
        xaxis: { 
          // tickDecimals: 0, 
          mode: "time", 
          timeformat: "%m/%d/%y"
        }
      });

    });

    // choiceContainer.find("input:checked").each(function () {
    //     var key = $(this).attr("name");
    //     if (key && datasets[key])
    //         data.push(datasets[key]);
    // });

    // if (data.length > 0)
  }

  plotAccordingToChoices();
});
</script>

<div id="placeholder" style="width: 800px; height: 400px; position: relative; ">

</div>
<div id="choices">
  <h2>Languages</h2>
</div>